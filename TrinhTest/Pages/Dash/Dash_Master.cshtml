@page
@{
    Layout = "_Layout";
}
@Html.AntiForgeryToken()
<script src="/js/Common/initialize_setting.js"></script>
<div class="container-fluid py-4" id="divMainSettingDetail">
    <div class="row">
        <div class="col-12 position-relative z-index-2">
            <div class="card card-plain mb-4">
                <div class="card-body p-3">
                    <div class="row">
                        <div class="col-lg-6">
                            <div class="h-100">
                                <h6 data-languagestatic="carrer_detail_header" class="mb-0">Dashboards</h6>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-sm-3">
                    <div class="card  mb-4">
                        <div class="card-body p-3">
                            <div class="row">
                                <div class="col-8">
                                    <div class="numbers">
                                        <p class="text-sm mb-0 text-capitalize font-weight-bold">Doctor</p>
                                        <h5 class="font-weight-bolder mb-0">
                                            <span id="Dash_User_Doctor" countto="0">0</span>
                                        </h5>
                                    </div>
                                </div>
                                <div class="col-4 d-flex justify-content-end">
                                    <div class="icon icon-shape bg-gradient-primary shadow text-center border-radius-md">
                                        <i class="fa fa-user-md text-lg opacity-10" aria-hidden="true"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-sm-3">
                    <div class="card  mb-4">
                        <div class="card-body p-3">
                            <div class="row">
                                <div class="col-8">
                                    <div class="numbers">
                                        <p class="text-sm mb-0 text-capitalize font-weight-bold">Patient</p>
                                        <h5 class="font-weight-bolder mb-0">
                                            <span id="Dash_Price_Patient" countto="0">0</span>
                                        </h5>
                                    </div>
                                </div>
                                <div class="col-4 d-flex justify-content-end">
                                    <div class="icon icon-shape bg-gradient-primary shadow text-center border-radius-md">
                                        <i class="fa fa-users text-lg opacity-10" aria-hidden="true"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-sm-3">
                    <div class="card  mb-4">
                        <div class="card-body p-3">
                            <div class="row">
                                <div class="col-8">
                                    <div class="numbers">
                                        <p class="text-sm mb-0 text-capitalize font-weight-bold">Appointment</p>
                                        <h5 class="font-weight-bolder mb-0">
                                            <span id="Dash_User_Appointment" countto="0">0</span>
                                        </h5>
                                    </div>
                                </div>
                                <div class="col-4 d-flex justify-content-end">
                                    <div class="icon icon-shape bg-gradient-primary shadow text-center border-radius-md">
                                        <i class="fa fa-calendar-plus-o text-lg opacity-10" aria-hidden="true"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-sm-3">
                    <div class="card  mb-4">
                        <div class="card-body p-3">
                            <div class="row">
                                <div class="col-8">
                                    <div class="numbers">
                                        <p class="text-sm mb-0 text-capitalize font-weight-bold">Prescription</p>
                                        <h5 class="font-weight-bolder mb-0">
                                            <span id="Dash_User_Prescription" countto="0">0</span>
                                        </h5>
                                    </div>
                                </div>
                                <div class="col-4 d-flex justify-content-end">
                                    <div class="icon icon-shape bg-gradient-primary shadow text-center border-radius-md">
                                        <i class="fa fa-plus-square text-lg opacity-10" aria-hidden="true"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="row">
        <div id="DashPriceServices" class="col-lg-5 position-relative z-index-2">
        </div>
        <div id="DashMedicineReport" class="col-lg-7 position-relative z-index-2">
        </div>
    </div>
</div>
<script src="/Assets/js/custom-validation.js"></script>
<script src="/Assets/js/plugins/threejs.js"></script>
<script src="/Assets/js/plugins/orbit-controls.js"></script>
<script src="/js/Common/initialize_setting.js"></script>
<script type="text/javascript">

    const iconNavbarSidenav = document.getElementById('iconNavbarSidenav');
    const iconSidenav = document.getElementById('iconSidenav');
    const sidenav = document.getElementById('sidenav-main');
    let body = document.getElementsByTagName('body')[0];
    let className = 'g-sidenav-pinned';
    $(document).ready(function (){
        LoadDataMenu();
        ShowMenuMater();
        CloseMneuMater();
        LoadDataUser();
        LoadDataPriceServices();
        LoadTempMedicineReport();
    });
    //Load head dashboard
    function LoadDataUser(){
         AjaxLoad(url = "/api/Mater/LoadDataHeardDashBoard"
            , data = {
            }, async = true
           , error = function () { notiError_SW(); }
            , success = function (result) {
                if (result != "") {
                    let data=JSON.parse(result);
                    DashMasterCountUpNumber("Dash_User_Doctor",data[0].APPOINTMENT_COUNT);
                    DashMasterCountUpNumber("Dash_Price_Patient",data[0].DOCTOR_COUNT);
                    DashMasterCountUpNumber("Dash_User_Prescription",data[0].PATIENT_COUNT);
                    DashMasterCountUpNumber("Dash_User_Appointment",data[0].PRESCRIPTION_COUNT);
                    notiSuccess();
                }
                else{
                    notiError_SW();
                }
            });
    }
     // execute click child node menu dash
    function eleClickMenuDash(){
         $("#collapse_Dashboards").addClass('show');
         $("#parent_Dashboards").children()[0].classList.add('bg-gradient-light');
        var ele=document.querySelectorAll('.settingCollapse');
        ele.forEach((node) => {
            node.addEventListener("click", e => {
                let countClick=0;
                if(e.target.children[1] != undefined){
                    countClick=1;
                }
            if($("#collapse_"+e.target.children[countClick].innerText).hasClass("show")){
                $("#collapse_"+e.target.children[countClick].innerText).removeClass("show");
                document.getElementById(e.target.id).setAttribute("aria-expanded", false);
                e.target.querySelector('div').classList.remove("bg-gradient-light");
            }
            else
                {
                    document.getElementById(e.target.id).setAttribute("aria-expanded", true);
                    $("#collapse_"+e.target.children[countClick].innerText).addClass("show");
                    e.target.querySelector('div').classList.add("bg-gradient-light");
                }
            })
        });
        $('#sidenav-collapse-main').on('click', '.Settingitem__item', function (e) {
                e.preventDefault();
                $('#sidenav-collapse-main .Settingitem__item').removeClass('active');
                let namechild = '', namegroup = '';
                namechild = $(this).attr("data-name");
                $(this).addClass('active');
                let objparent = $(this).parent().parent();
                if (objparent != undefined) {
                    objparent.addClass('active');
                    namegroup = objparent.attr("data-name");
                }
                let href = $(this).attr('href');
                let hreflayoutnone = href + '?layout=none' + '&ver=' + versionofWebApplication;
                MS_UrlRoot = namegroup;
                MS_UrlChild = namechild;
                if (href != '#') {
                    $.ajax({
                        url: hreflayoutnone,
                        success: function (data) {
                            $("#MainRenderBody").empty();
                            $("#MainRenderBody_Manual").html(data);
                            window.history.pushState(href, 'Title', hreflayoutnone);
                           // MS_SetHeaderNavi();
                        }
                    })
                }
    });
    }
    function DashMasterCountUpNumber(id,valueCount){
        if (document.getElementById(id).hasAttribute("countTo")) {
                     document.getElementById(id).setAttribute("countTo", valueCount);
             };
        if (document.getElementById(id)) {
          const countUp = new CountUp(id, document.getElementById(id).getAttribute("countTo"));
          if (!countUp.error) {
            countUp.start();
          }
        }
    }
    ////
    function ExecuteText(){
         $('#form_Career').form('validate form');
         if ($('#accountDetail').form('is valid')) {
         }
    }
    function LoadDataMenu(){
         AjaxLoad(url = "/api/Mater/LoadDataMenu"
            , data = {
            }, async = true
           , error = function () { notiError_SW(); }
            , success = function (result) {
                if (result != "") {
                    let data=JSON.parse(result);
                    console.log(data);
                     RenderDataMenuMater(data,"sidenav-collapse-main");
                     eleClickMenuDash();
                    notiSuccess();
                }
                else{
                    notiError_SW();
                }
            });
    }
    ///
    function RenderDataMenuMater(data,id){
        let stringContent = '';
        for(let i=0;i<data.length;i++){
            let item=data[i];
            let replaceDataCollapse='';
            if(item.Childs.length >0){
                replaceDataCollapse='data-bs-toggle="collapse" aria-controls='+item.Name+' role="button" aria-expanded="false"'
            }
            let tr ='<li class="nav-item settingCollapse">'
                    +'<a '+replaceDataCollapse+' href="#" id="parent_'+item.Name+'" class="nav-link cursor-pointer">'
                    +'<div class="icon icon-shape icon-sm shadow border-radius-md bg-white text-center d-flex align-items-center justify-content-center me-2">'
                    +'<i class="'+item.Img+' text-secondary"></i>'
                    +'</div>'
                    +'<span class="text-dark">'+item.Name+'</span>'
                    +'</a>'
                    + RenderDataChildMasterMenu(item.Childs,item.Name)
                    +'</li>';
          stringContent=stringContent+tr;
        }
         document.getElementById(id).innerHTML = stringContent;
    }
    function RenderDataChildMasterMenu(dataChild,id){
        let resulf  = '';
        if(dataChild.length >0){
            console.log(id)
            let tr ='<div class="collapse" id=collapse_'+id+'>'
                     +'<ul class="nav ms-2 ps-3 me-2">'
            for(let i=0;i<dataChild.length;i++){
                var item=dataChild[i];
                 let coll='href="' + item.Url + '"';
                 if(dataChild[i].ChildNode.length>0){
                     coll='data-bs-toggle="collapse" href="#"'
                 }

                tr += '<li class="nav-item cursor-pointer">'
                    +'<a class="nav-link Settingitem__item"'+coll+'id="Layout_'+item.Name+'">'
                    +'<span class="sidenav-normal">'+item.Name+'</span>'
                    +'</a>'
                    +RenderDataChildMasterMenu(dataChild[i].ChildNode,item.Name)
                    +'</li>'
            }
            resulf=resulf+tr+'</ul>'+'</div>';
        }
        return resulf;
    }
    function ShowMenuMater(){
        if (iconNavbarSidenav) {
            iconNavbarSidenav.addEventListener("click", toggleSidenav);
        }
    }
    function CloseMneuMater(){
        if (iconSidenav) {
            iconSidenav.addEventListener("click", toggleSidenav);
        }
    }
    function PopUpDetail(){
            $("#DetailModal_Content").html('');
            $("#DetailModal_Content").load("/Login/ChangePassword");
            $('#DetailModal').modal('show');
            return false;
    }
    function toggleSidenav() {
        if (body.classList.contains(className)) {
        body.classList.remove(className);
        setTimeout(function() {
            sidenav.classList.remove('bg-white');
        }, 100);
        sidenav.classList.remove('bg-transparent');

        } else {
        body.classList.add(className);
        sidenav.classList.add('bg-white');
        sidenav.classList.remove('bg-transparent');
        iconSidenav.classList.remove('d-none');
        }
    };
    //LoadDataPriceServices
    function LoadDataPriceServices(){
         $("#DashPriceServices").html('');
          $("#DashPriceServices").load("/Setting/Services/SettingPriceServices");
       };
    //LoadTempMessages chatbots
    function LoadTempMedicineReport(){
        $("#DashMedicineReport").html('');
        $("#DashMedicineReport").load("/Report/Medicine/MedicineReport");
    };
</script>
<style>
    .navbar-vertical .navbar-nav .nav-link[data-bs-toggle=collapse][aria-expanded=true]:after {
        color: #67748e;
        transform: rotate(180deg);
    }

</style>