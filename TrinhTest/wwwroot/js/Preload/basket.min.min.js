/*!
* basket.js
* v0.5.2 - 2015-02-07
* http://addyosmani.github.com/basket.js
* (c) Addy Osmani;  License
* Created by: Addy Osmani, Sindre Sorhus, AndrÃ©e Hansson, Mat Scales
* Contributors: Ironsjp, Mathias Bynens, Rick Waldron, Felipe Morais
* Uses rsvp.js, https://github.com/tildeio/rsvp.js
*/
!function(n,t){"use strict";var h=t.head||t.getElementsByTagName("head")[0],i="basket-",c=5e3,u=[],f=function(n,t){try{return localStorage.setItem(i+n,JSON.stringify(t)),!0}catch(e){if(e.name.toUpperCase().indexOf("QUOTA")>=0){var u,r=[];for(u in localStorage)0===u.indexOf(i)&&r.push(JSON.parse(localStorage[u]));return r.length?(r.sort(function(n,t){return n.stamp-t.stamp}),basket.remove(r[0].key),f(n,t)):void 0}return}},l=function(n){return new RSVP.Promise(function(t,i){var r=new XMLHttpRequest;r.open("GET",n);r.onreadystatechange=function(){4===r.readyState&&(200===r.status||0===r.status&&r.responseText?t({content:r.responseText,type:r.getResponseHeader("content-type")}):i(new Error(r.statusText)))};setTimeout(function(){r.readyState<4&&r.abort()},basket.timeout);r.send()})},a=function(n){return l(n.url).then(function(t){var i=v(n,t);return n.skipCache||f(n.key,i),i})},v=function(n,t){var i=+new Date;return n.data=t.content,n.originalType=t.type,n.type=n.type||t.type,n.skipCache=n.skipCache||!1,n.stamp=i,n.expire=i+36e5*(n.expire||c),n},y=function(n,t){return!n||n.expire-+new Date<0||t.unique!==n.unique||basket.isValidItem&&!basket.isValidItem(n,t)},p=function(n){var t,i,r;if(n.url)return n.key=n.key||n.url,t=basket.get(n.key),n.execute=n.execute!==!1,r=y(t,n),n.live||r?(n.unique&&(n.url+=(n.url.indexOf("?")>0?"&":"?")+"basket-unique="+n.unique),i=a(n),n.live&&!r&&(i=i.then(function(n){return n},function(){return t}))):(t.type=n.type||t.originalType,t.execute=n.execute,i=new RSVP.Promise(function(n){n(t)})),i},w=function(n){var i=t.createElement("script");i.defer=!0;i.text=n.data;h.appendChild(i)},r={"default":w},b=function(n){return n.type&&r[n.type]?r[n.type](n):r["default"](n)},e=function(n){return n.map(function(n){return n.execute&&b(n),n})},o=function(){for(var i=[],n=0,t=arguments.length;t>n;n++)i.push(p(arguments[n]));return RSVP.all(i)},s=function(){var t=o.apply(null,arguments),n=this.then(function(){return t}).then(e);return n.thenRequire=s,n};n.basket={require:function(){for(var t,n=0,i=arguments.length;i>n;n++)arguments[n].execute=arguments[n].execute!==!1,arguments[n].once&&u.indexOf(arguments[n].url)>=0?arguments[n].execute=!1:arguments[n].execute!==!1&&u.indexOf(arguments[n].url)<0&&u.push(arguments[n].url);return t=o.apply(null,arguments).then(e),t.thenRequire=s,t},remove:function(n){return localStorage.removeItem(i+n),this},get:function(n){var t=localStorage.getItem(i+n);try{return JSON.parse(t||"false")}catch(r){return!1}},clear:function(n){var r,t,u=+new Date;for(r in localStorage)t=r.split(i)[1],t&&(!n||this.get(t).expire<=u)&&this.remove(t);return this},isValidItem:null,timeout:5e3,addHandler:function(n,t){Array.isArray(n)||(n=[n]);n.forEach(function(n){r[n]=t})},removeHandler:function(n){basket.addHandler(n,void 0)}};basket.clear(!0)}(this,document);